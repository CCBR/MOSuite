test_that("plot_expr_heatmap works", {
  moo <- multiOmicDataSet(
    sample_metadata = as.data.frame(nidap_sample_metadata),
    anno_dat = data.frame(),
    counts_lst = list(
      "raw" = as.data.frame(nidap_raw_counts),
      "clean" = as.data.frame(nidap_clean_raw_counts),
      "filt" = as.data.frame(nidap_filtered_counts),
      "norm" = list(
        "voom" = as.data.frame(nidap_norm_counts)
      )
    )
  )
  # TODO refactor plot_expr_heatmap to avoid triggering warnings
  expect_warning(
    expect_warning(
      expect_warning(
        p <- plot_expr_heatmap(moo, count_type = "norm", sub_count_type = "voom")
      )
    )
  )
  expect_equal(
    head(p@matrix),
    structure(c(
      -0.469646298150098, -0.999122775178692, -1.63914985230916,
      -1.11065487632401, 1.06508157716121, 0.129357631742822, -1.6308124461643,
      -0.700059853143015, -1.5189464375787, -0.224167735591629, 1.06508157716121,
      -1.56168918461362, -1.6308124461643, -1.89235880186714, -0.541702967261003,
      -2.0463972593436, 1.06508157716121, -1.79694425364586, 0.329750044812768,
      0.0301570520160167, 0.167894484181845, -0.0423239634814564, -0.120254965774652,
      0.199342022111398, 0.642860459417498, 0.367952795408648, 0.373030023826938,
      0.474515861027971, -0.0390725679377215, 0.117730807477454, 0.728033358831939,
      0.385380968911897, 0.599797184786654, 0.453174107982841, -0.104093868102577,
      0.461536877004385, 0.623852071863989, 0.835927627565177, 0.888284230577201,
      0.725967683142828, -1.99037275585028, 0.831065997888202, 0.825036578059704,
      1.0208559858833, 0.853098375022516, 0.922704248230578, -0.758155232754779,
      0.657242141825761, 0.581738677492799, 0.951267000403811, 0.817694958753715,
      0.847181934356472, -0.183295341063619, 0.962357960209459
    ), dim = c(
      6L,
      9L
    ), dimnames = list(c(
      "Il2rb", "Rora", "Tcrg-C1", "Pdcd1", "Dntt",
      "Eya2"
    ), c("A1", "A2", "A3", "B1", "B2", "B3", "C1", "C2", "C3")))
  )
})
