---
title: "MOSuite analysis report"
date: today
format: html
params:
    counts_tsv: 'RSEM.genes.expected_count.all_samples.txt.gz'
    samplesheet_tsv: 'sample_metadata.tsv.gz'
    print_plots: true
engine: knitr
---

```{r deps}
library(MOSuite)
library(dplyr)

options(moo_prints_plots = params$print_plots)
```

```{r initialize}
# create multi-omic object
moo <- create_multiOmicDataSet_from_files(
  sample_meta_filepath = params$samplesheet_tsv,
  feature_counts_filepath = params$counts_tsv
)
```

```{r analyze}
moo %<>%
  clean_raw_counts() %>%
  filter_counts(
    group_colname = "condition",
    label_colname = "sample_id",
    minimum_count_value_to_be_considered_nonzero = 1,
    minimum_number_of_samples_with_nonzero_counts_in_total = 1,
    minimum_number_of_samples_with_nonzero_counts_in_a_group = 1,
  ) %>%
  normalize_counts(
    group_colname = "condition",
    label_colname = "sample_id"
  ) %>%
  diff_counts(
    covariates_colnames = "condition",
    contrast_colname = "condition",
    contrasts = c("knockout-wildtype")
  ) %>%
  filter_diff(
    significance_cutoff = 0.05,
    significance_column = "adjpval",
    change_column = "logFC",
    change_cutoff = 1
  )

moo@analyses$diff_filt %>% head() %>% knitr::kable()
```
