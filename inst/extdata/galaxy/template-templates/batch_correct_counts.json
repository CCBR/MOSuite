{
    "title": "Batch Correction",
    "description": "This template performs batch correction on RNA-seq expression data to account for batch effects that can arise whenever some samples are prepared in a different manner or at a different time than others.  It takes a counts matrix (usually the normalized counts matrix) and your metadata table as input and provides two QC plots and a normalized expression matrix as output.  This template is only necessary if your dataset has more than one batch.  When necessary, it is usually the third step (after normalization) in the QC portion of a bulk RNA-seq analysis.\n\nBatch correction can only be attempted if your Batch variable is not completely confounded with your Group variable (see your metadata table).  The two QC plots, a PCA plot and counts frequency histogram, are provided to help assess within and between group variance and the dis/similarity of sample count distributions, respectively.\n\nThe batch correction applied by this template is performed using the 'sva' R package's ComBat method.",
    "r_function": "batch_correct_counts",
    "columns": [
        {
            "key": "feature_id_colname",
            "displayName": "Feature ID Column",
            "description": "The column from your input Counts Matrix containing the Feature IDs (Usually Gene or Protein ID). This is usually the first column of your input Counts Matrix. Only columns of Text type from your input Counts Matrix will be available to select for this parameter.",
            "paramGroup": "Basic",
            "sourceDataset": "counts_matrix",
            "defaultValue": null,
            "columnType": "STRING",
            "isMulti": null
        },
        {
            "key": "samples_to_include",
            "displayName": "Columns to Include",
            "description": "Which Columns would you like to include? Usually, you will choose to \"Add all\" (see button on right). Columns excluded here will be removed in this step and from further analysis downstream of this step.",
            "paramGroup": "Basic",
            "sourceDataset": "counts_matrix",
            "defaultValue": null,
            "columnType": "ALL",
            "isMulti": true
        },
        {
            "key": "sample_id_colname",
            "displayName": "Sample Names Column",
            "description": "The column from your input Sample Metadata table containing the sample names. The names in this column must exactly match the names used as the sample column names of your input Counts Matrix. Only columns of Text type from your input Sample Metadata table will be available to select for this parameter.",
            "paramGroup": "Basic",
            "sourceDataset": "sample_metadata",
            "defaultValue": null,
            "columnType": "STRING",
            "isMulti": null
        },
        {
            "key": "group_colname",
            "displayName": "Groups Column",
            "description": "The column from your input Sample Metadata table containing the sample group information. This is usually a column showing to which experimental treatments each sample belongs (e.g. WildType, Knockout, Tumor, Normal, Before, After, etc.). Only columns of Text type from your input Sample Metadata will be available to select for this parameter.",
            "paramGroup": "Basic",
            "sourceDataset": "sample_metadata",
            "defaultValue": null,
            "columnType": "STRING",
            "isMulti": null
        },
        {
            "key": "covariates_colnames",
            "displayName": "Covariates",
            "description": "The column(s) from your input Sample Metadata table containing variable(s) of interest, such as phenotype. Most commonly this will be the same column you selected for your Groups Column (above). Some experimental designs may require that you add additional covariate columns here. \nNB. Do not include the \"Batch\" column here.",
            "paramGroup": "Basic",
            "sourceDataset": "sample_metadata",
            "defaultValue": null,
            "columnType": "ALL",
            "isMulti": true
        },
        {
            "key": "batch_colname",
            "displayName": "Batch Column",
            "description": "The column from your input Sample Metadata table containing the batch information. Samples extracted, prepared, or sequenced at separate times or using separate materials/staff/equipment may belong to different batches. Not all datasets have batches. If yours dataset has no batches, you must still provide a Batch column with the same value in every row.",
            "paramGroup": "Basic",
            "sourceDataset": "sample_metadata",
            "defaultValue": null,
            "columnType": "ALL",
            "isMulti": null
        },
        {
            "key": "label_colname",
            "displayName": "Labels Column",
            "description": "The column from your input Sample Metadata table containing the sample labels as you wish them to appear in the plots produced by this template. This can be the same Sample Names Column (see above). However, you may desire different labels to display on your figure (e.g. shorter labels are sometimes preferred on plots). In that case, select the column with your preferred Labels here.",
            "paramGroup": "Basic",
            "sourceDataset": "sample_metadata",
            "defaultValue": null,
            "columnType": "ALL",
            "isMulti": null
        }
    ],
    "inputDatasets": [
        {
            "key": "counts_matrix",
            "displayName": "Counts Matrix",
            "description": "The input Counts Matrix. Usually, this will be your Normalized Counts matrix.",
            "paramGroup": "Basic",
            "anchorDataset": false,
            "dataType": "R_NATIVE_DATAFRAME",
            "tags": []
        },
        {
            "key": "sample_metadata",
            "displayName": "Sample Metadata",
            "description": "The Sample Metadata table containing your sample metadata. At minimum, this table must include one column each of the following: Samples, Groups, Batches, and Labels. The names in the Samples column of your input Sample Metadata must match the Sample Column Names of your input Counts Matrix exactly. You may have more than one column showing different Groups by which your samples may be organized (e.g. Genotype, Response, Time, etc.).",
            "paramGroup": "Basic",
            "anchorDataset": false,
            "dataType": "R_NATIVE_DATAFRAME",
            "tags": []
        }
    ],
    "parameters": [
        {
            "key": "samples_to_rename",
            "displayName": "Samples to Rename Manually on PCA",
            "description": "Enter each sample to rename in the format: old_name: new_name",
            "paramType": "VECTOR",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "c(\"\")",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "add_label_to_pca",
            "displayName": "Add Labels to PCA",
            "description": "Toggle to TRUE to use the column from \"Label Column to Use for Plots\" (above) to label points on the PCA plot. Toggle to FALSE to remove these labels from the plot. Default is TRUE.",
            "paramType": "BOOLEAN",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "TRUE",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "principal_component_on_x_axis",
            "displayName": "Principal Component on X-axis for PCA",
            "description": "The principle component to plot on the x-axis. Choices include 1, 2, 3, ... (default: 1)",
            "paramType": "NUMBER",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "1",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "principal_component_on_y_axis",
            "displayName": "Principal Component on Y-axis for PCA",
            "description": "The principle component to plot on the y-axis. Choices include 1, 2, 3, ... (default: 2)",
            "paramType": "NUMBER",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "2",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "legend_position_for_pca",
            "displayName": "Legend Position for PCA",
            "description": "Legend position relative to the plot",
            "paramType": "SELECT",
            "paramGroup": "PCA",
            "paramValues": [
                "top",
                "bottom",
                "left",
                "right",
                "none"
            ],
            "defaultValue": "top",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "label_offset_x_",
            "displayName": "Label Offset (x) for PCA",
            "description": "",
            "paramType": "NUMBER",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "2",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "label_offset_y_",
            "displayName": "Label Offset (y) for PCA",
            "description": "",
            "paramType": "NUMBER",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "2",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "point_size_for_pca",
            "displayName": "Point Size for PCA",
            "description": "Size of a each data point on the PCA.",
            "paramType": "NUMBER",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "2",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "label_font_size",
            "displayName": "Label Font Size for PCA",
            "description": "Font size for sample labels on the PCA. Set to 0 to remove labels.",
            "paramType": "NUMBER",
            "paramGroup": "PCA",
            "paramValues": null,
            "defaultValue": "3",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "color_histogram_by_group",
            "displayName": "Color Histogram by Group",
            "description": "Toggle to FALSE to label histogram by Sample Names. Toggle to TRUE to label histogram by the column you select in the \"Group Column Used to Color Histogram\" parameter (below). Default is FALSE.",
            "paramType": "BOOLEAN",
            "paramGroup": "Histogram",
            "paramValues": null,
            "defaultValue": "FALSE",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "set_min_max_for_x_axis_for_histogram",
            "displayName": "Set Max/Min for X-axis for Histogram",
            "description": "",
            "paramType": "BOOLEAN",
            "paramGroup": "Histogram",
            "paramValues": null,
            "defaultValue": "FALSE",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "maximum_for_x_axis_for_histogram",
            "displayName": "Maximum X-axis in Histogram",
            "description": "",
            "paramType": "NUMBER",
            "paramGroup": "Histogram",
            "paramValues": null,
            "defaultValue": "1",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "minimum_for_x_axis_for_histogram",
            "displayName": "Minimum X-axis in Histogram",
            "description": "",
            "paramType": "NUMBER",
            "paramGroup": "Histogram",
            "paramValues": null,
            "defaultValue": "-1",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "legend_font_size_for_histogram",
            "displayName": "Legend Font Size for Histogram",
            "description": "Legend font size for the histogram.",
            "paramType": "NUMBER",
            "paramGroup": "Histogram",
            "paramValues": null,
            "defaultValue": "10",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "legend_position_for_histogram",
            "displayName": "Legend Position for Histogram",
            "description": "Legend position on histogram plot, can be 'none' if large number of samples",
            "paramType": "SELECT",
            "paramGroup": "Histogram",
            "paramValues": [
                "right",
                "bottom",
                "left",
                "top",
                "none"
            ],
            "defaultValue": "top",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "Number_of_Histogram_Legend_Columns",
            "displayName": "Number of Histogram Legend Columns",
            "description": "",
            "paramType": "NUMBER",
            "paramGroup": "Histogram",
            "paramValues": null,
            "defaultValue": "6",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "colors_for_plots",
            "displayName": "Colors for plots",
            "description": "Colors for the PCA and histogram will be picked, in order, from this list.  If more colors are needed, program will choose from a wide range of random colors",
            "paramType": "MULTISELECT",
            "paramGroup": "Visualization",
            "paramValues": [
                "indigo",
                "carrot",
                "lipstick",
                "turquoise",
                "lavender",
                "jade",
                "coral",
                "azure",
                "green",
                "rum",
                "orange",
                "olive"
            ],
            "defaultValue": "c(\"indigo\",\"carrot\",\"lipstick\",\"turquoise\",\"lavender\",\"jade\",\"coral\",\"azure\",\"green\",\"rum\",\"orange\",\"olive\")",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "Number_of_Image_Rows",
            "displayName": "Number of Image Rows",
            "description": "1 = side-by-side, 2 = stacked",
            "paramType": "NUMBER",
            "paramGroup": "Visualization",
            "paramValues": null,
            "defaultValue": "2",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "interactive_plots",
            "displayName": "Make Plots Interactive",
            "description": "Toggle TRUE to make PCA and Histogram plots interactive, allowing you to hover your mouse over a point or line to view sample information. The similarity heatmap will not display if this toggle is set to TRUE. Default is FALSE.",
            "paramType": "BOOLEAN",
            "paramGroup": "Visualization",
            "paramValues": null,
            "defaultValue": "FALSE",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "Plot_Correlation_Matrix_Heatmap_",
            "displayName": "Plot Correlation Matrix Heatmap ",
            "description": "Datasets with a large number of samples may be too large to create a correlation matix heatmap. If this template takes longer than 5 minutes to run, Toggle switch to FALSE and the correlation matrix will not be be created. Default is TRUE.",
            "paramType": "BOOLEAN",
            "paramGroup": "TCGA",
            "paramValues": null,
            "defaultValue": "TRUE",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        },
        {
            "key": "skip_batch_correction",
            "displayName": "Skip Batch Correction",
            "description": "",
            "paramType": "BOOLEAN",
            "paramGroup": "Basic",
            "paramValues": null,
            "defaultValue": "FALSE",
            "condition": null,
            "content": null,
            "objectPropertyReference": null
        }
    ]
}